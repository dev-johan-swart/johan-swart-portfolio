<!doctype html>
<html lang="en">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Set new password</title><link rel="stylesheet" href="style.css"/></head>
<body>
  <div class="center">
    <div class="card">
      <div class="header"><div class="logo">NP</div><div><h2 class="h-title">Set new password</h2><p class="h-sub">Follow the link in email</p></div></div>
      <form id="resetForm" class="form">
        <input class="input" id="password" type="password" placeholder="New password" required/>
        <button class="btn" type="submit">Set password</button>
        <div id="msg"></div>
      </form>
    </div>
  </div>
  <div id="loading" class="loading-overlay"><div class="loader"><div class="spinner"></div></div></div>
  <script src="script.js"></script>
  <script>
  // parse token and id from querystring
  const qs = new URLSearchParams(location.search);
  const token = qs.get('token'), id = qs.get('id');
  if (!token || !id) document.getElementById('msg').textContent='Invalid link';

  document.getElementById('resetForm').addEventListener('submit', async e => {
    e.preventDefault(); showLoading(); clearMsg();
    const password = document.getElementById('password').value;
    const r = await fetch('/api/reset', { method:'POST', credentials:'include', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id, token, password }) });
    const j = await r.json();
    hideLoading();
    if (!r.ok) showMsg(j.error || 'Failed', true); else { showMsg('Password updated, redirecting...'); setTimeout(()=>location.href='/login.html',1200); }
  });
  </script>
</body>
</html>
